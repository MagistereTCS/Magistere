define(["local_magisterelib/jtable"],function(){function a(a,c,d,e,f,g,h,i,j,k,l,m,n){1==f&&($("#search_result").append('<input type="button" value="'+l+'" id="add_resource_button"/>'),$("#add_resource_button").click(function(){window.location.href=h}));var o=!0;$("#search_result").jtable({title:j,paging:!0,pageSize:20,pageSizes:[20,30,40],selecting:!0,multiselect:!1,selectingCheckboxes:d,sorting:!0,defaultSorting:"name ASC",jqueryuiTheme:!0,defaultDateFormat:"dd-mm-yy",gotoPageArea:"none",selectOnRowClick:!1,actions:{listAction:function(b,d){return $.Deferred(function(e){var f=$("#mform1").serialize(),g=b&&b.jtStartIndex;g||(g=d.jtStartIndex),f+="&si="+g+"&ps="+d.jtPageSize+"&so="+d.jtSorting,""!=n&&(f+="&contextid="+n),$("#id_centralizedresourceid").val()&&o?(f="ps="+d.jtPageSize+"&so="+d.jtSorting+"&record_id="+$("#id_centralizedresourceid").val(),$.ajax({type:"POST",url:c,dataType:"json",data:f,success:function(a){o=!1;var b=$("#search_result").data("hik-jtable");b._currentPageNo=a.page,b._reloadTable()},error:function(){e.reject()}})):$.ajax({type:"POST",url:a,dataType:"json",data:f,success:function(a){e.resolve(a)},error:function(){e.reject()}})})}},fields:{id:{title:"id",key:!0,create:!1,edit:!1,list:!1},name:{title:"Titre",width:"20%",create:!1,edit:!1,list:!0},label_type:{title:"Type",width:"20%",create:!1,edit:!1,list:!0},domain:{title:"Domaine",width:"20%",create:!1,edit:!1,list:!0},creator:{title:"Créateur",width:"10%",create:!1,edit:!1,list:!0},updatedate:{title:"Modif",type:"date",create:!1,edit:!1,list:!0},action:{title:"Action",width:"5%",create:!1,edit:!1,list:e,sorting:!1,display:function(a){return null!==a.record.action?"<a href="+a.record.action+">Modifier</a>":""}},lastusedate:{title:"Accès",width:"5%",type:"date",create:!1,edit:!1,sorting:!1},views:{title:"Vues",width:"5%",edit:!1,sorting:!1}},selectionChanged:function(a,c){var d=$("#search_result").jtable("selectedRows");d.length>0&&d.each(function(){var a=$(this).data("record");a.id;$("#id_centralizedresourceid").val(a.id),b(a.type)})},rowInserted:function(a,c){c.record.id==$("#id_centralizedresourceid").val()&&($("#search_result").data("hik-jtable")._selectRows(c.row),b(c.record.type))}}),1==f&&($("#search_result").append('<br/><input type="button" value="'+l+'" id="add_resource_button_down"/>'),$("#add_resource_button_down").click(function(){window.location.href=h})),1==g&&($("#search_result").append('<input type="button" value="'+k+'" id="return_button"/>'),$("#return_button").click(function(){window.location.href=i})),console.log(j),$("#search_result").jtable("load")}function b(a){"diaporama"==a?($("#id_display > option[value$='{[{RESOURCELIB_DISPLAY_DOWNLOAD}]}']").hide(),"{[{RESOURCELIB_DISPLAY_DOWNLOAD}]}"==$("#id_display").val()&&$("#id_display").val("0")):$("#id_display > option[value$='{[{RESOURCELIB_DISPLAY_DOWNLOAD}]}']").show()}return{init:function(b,c,d,e,f,g,h,i,j,k,l,m,n){a(b,c,d,e,f,g,h,i,j,k,l,m,n)}}});
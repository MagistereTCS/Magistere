define(["jquery","jqueryui","local_taskmonitor/jtable"],function(a){function b(){function b(){downloading=!0,a("#mform1").attr("action","view_statsparticipants_per_academy_export.php?action=export&format=csv&so="+sortorder),a("#lastconnmin").val(new Date(a("#id_lastconnmin_dt_year").val(),a("#id_lastconnmin_dt_month").val()-1,a("#id_lastconnmin_dt_day").val()).getTime()),a("#lastconnmax").val(new Date(a("#id_lastconnmax_dt_year").val(),a("#id_lastconnmax_dt_month").val()-1,a("#id_lastconnmax_dt_day").val()).getTime()),a("#mform1").submit(),downloading=!1}function c(){a("#exportTable").dialog({modal:!1,closeOnEscape:!0,width:"600px"}).show()}a("#mform1").submit(function(b){downloading===!1&&(b.preventDefault(),a("#resultTable").jtable("load"))}),a("#id_b_downloadcsv").on("click",function(){b()}),a("#id_b_export").on("click",function(){c()}),a("#resultTable").jtable({title:"",paging:!0,pageSize:20,pageSizes:[20,50,100],selecting:!1,multiselect:!1,selectingCheckboxes:!1,sorting:!0,defaultSorting:"classname ASC",jqueryuiTheme:!0,defaultDateFormat:"dd-mm-yy",gotoPageArea:"none",selectOnRowClick:!1,actions:{listAction:function(b,c){return a.Deferred(function(d){b={priority:a("#id_filterPriority option:selected").val(),view:a("#id_filterView option:selected").val(),tasks:a("#taskselect").val(),platform:a("#id_filterPlatform option:selected").val(),sorting:c.jtSorting,startindex:c.jtStartIndex,pagesize:c.jtPageSize},a.ajax({url:"api.php",type:"POST",dataType:"json",data:b,success:function(b){0==b.TotalRecordCount?a("#resultTable").parent().append('<p class="noresults"></p>'):(b.showplatform?a("#resultTable").jtable("changeColumnVisibility","platform","visible"):a("#resultTable").jtable("changeColumnVisibility","platform","hidden"),a("#resultTable").show(),a(".noresults").remove()),d.resolve(b)},error:function(){d.reject()}})})}},fields:{classname:{title:"Tâches",create:!1,edit:!1,list:!0},component:{title:"Composant",create:!1,edit:!1,list:!0},server:{title:"Serveur",create:!1,edit:!1,list:!0},platform:{title:"Plateforme",create:!1,edit:!1,list:!0},type:{title:"Nature",create:!1,edit:!1,list:!0},disabled:{title:"Etat",create:!1,edit:!1,list:!0,sorting:!1},runfrequency:{title:"Paramétrage",create:!1,edit:!1,list:!0,sorting:!1},lastrun:{title:"Dernière execution",create:!1,edit:!1,list:!0,sorting:!1},status:{title:"Statut",create:!1,edit:!1,list:!0},queries:{title:"Nombre de requêtes",create:!1,edit:!1,list:!0,sorting:!1},runtime:{title:"Durée de l'éxecution",create:!1,edit:!1,list:!0,sorting:!1}}}),a("#filtersubmit").on("click",function(){a("#resultTable").jtable("load")}),a("#tasksearch").on("keyup",function(){var b=a("#tasksearch").val();a("#taskselect > option").each(function(c){this.value.search(b)>-1||a(this).attr("data").search(b)>-1?a(this).show():a(this).hide()})}),a("#id_filterView").on("change",function(){var b=a("#id_filterView option:selected").val();2==b?(a("#taskmonitor #fitem_id_filterPlatform").show(),a("#taskmonitor #taskitem").hide()):3==b?(a("#taskmonitor #fitem_id_filterPlatform").hide(),a("#taskmonitor #taskitem").show()):(a("#taskmonitor #fitem_id_filterPlatform").hide(),a("#taskmonitor #taskitem").hide())}),2==a("#id_filterView").val()&&(a("#taskmonitor #fitem_id_filterPlatform").show(),a("#taskmonitor #taskitem").hide())}return{init:function(){b()}}});
define(["jquery","jqueryui"],function(a){return{init:function(b,c,d,e){function f(b,c){a("#dispositif_id").val(b),a("#dispositif_input").val(b+" : "+c),a("#dispositif_input").prop("disabled",!0),a("#dispositif_search_btn").prop("disabled",!0),a("#dispositif_res").html(""),l(),w()}function g(){a("#dispositif_res").html(""),a("#dispositif_input").val(""),a("#dispositif_input").prop("disabled",!1),a("#dispositif_search_btn").prop("disabled",!1),k(!1),p(),w(!1)}function h(){return clearTimeout(D),!(a("#dispositif_input").val().length>0&&a("#dispositif_input").val().length<3)&&void a.ajax({type:"POST",url:b,data:JSON.stringify({type:"dispositifs",courseid:a("#course_id").val(),startdate:A(a("#startdate").val()),enddate:A(a("#enddate").val()),dispositif:a("#dispositif_input").val()}),datatype:"json",success:function(b){var c=JSON.parse(b).dispositifs,d=a("<ul>");if(c.length>0)for(var e=0,f=c.length;e<f;++e){var g=" "+c[e].modulecount+" module";c[e].modulecount>1&&(g+="s"),d.append('<li data-id="'+c[e].dispositif_id+'" data-name="'+c[e].dispositif_name+'"><div class ="title">'+c[e].dispositif_id_high+" : "+c[e].dispositif_name_high+" ("+c[e].dispositif_origin+') </div><div class ="module">'+g+"</div></li>")}else d.append("<li>Aucun résultat</li>");a("#dispositif_res").html(d)},error:function(a){console.log(a)}})}function i(b,c){a("#module_id").val(b),a("#module_input").val(b+" : "+c),a("#module_input").prop("disabled",!0),a("#module_search_btn").prop("disabled",!0),a("#module_res").html(""),q(),x()}function j(){a("#module_res").html(""),a("#module_input").val(""),a("#module_input").prop("disabled",!1),a("#module_search_btn").prop("disabled",!1),n("",""),x(!1)}function k(){a("#module_id").val(""),a("#module_input").val(""),a("#module_input").prop("disabled",!0),a("#module_search_btn").prop("disabled",!0),a("#module_reset_btn").prop("disabled",!0),a("#module_res").html(""),p()}function l(){a("#module_id").val(""),a("#module_input").val(""),a("#module_input").prop("disabled",!1),a("#module_search_btn").prop("disabled",!1),a("#module_reset_btn").prop("disabled",!1),a("#module_res").html("")}function m(){return clearTimeout(E),!(a("#module_input").val().length>0&&a("#module_input").val().length<3)&&void a.ajax({type:"POST",url:b,data:JSON.stringify({type:"modules",courseid:a("#course_id").val(),startdate:A(a("#startdate").val()),enddate:A(a("#enddate").val()),dispositif:a("#dispositif_id").val(),module:a("#module_input").val()}),datatype:"json",success:function(b){var c=JSON.parse(b).modules,d=a("<ul>");if(c.length>0)for(var e=0,f=c.length;e<f;++e){var g=" "+c[e].sessioncount+" session";c[e].sessioncount>1&&(g+="s"),d.append('<li data-id="'+c[e].module_id+'" data-name="'+c[e].module_name+'"><div class ="title">Module '+c[e].module_id_high+" : "+c[e].module_name_high+'</div><div class="session">'+g+"</div></li>")}else d.append("<li>Aucun résultat</li>");a("#module_res").html(d)},error:function(a){console.log(a)}})}function n(b,c){a("#session_id").val(b),a("#session_input").val(b+" : "+c),a("#session_input").prop("disabled",!0),a("#session_search_btn").prop("disabled",!0),a("#session_res").html(""),s()}function o(){a("#session_res").html(""),a("#session_input").val(""),a("#session_input").prop("disabled",!1),a("#session_search_btn").prop("disabled",!1),y(!1)}function p(){a("#session_id").val(""),a("#session_input").val(""),a("#session_input").prop("disabled",!0),a("#session_search_btn").prop("disabled",!0),a("#session_reset_btn").prop("disabled",!0),a("#session_res").html("")}function q(){a("#session_id").val(""),a("#session_input").val(""),a("#session_input").prop("disabled",!1),a("#session_search_btn").prop("disabled",!1),a("#session_reset_btn").prop("disabled",!1),a("#session_res").html("")}function r(){return clearTimeout(F),!(a("#session_input").val().length>0&&a("#session_input").val().length<3)&&void a.ajax({type:"POST",url:b,data:JSON.stringify({type:"sessions",courseid:a("#course_id").val(),startdate:A(a("#startdate").val()),enddate:A(a("#enddate").val()),dispositif:a("#dispositif_id").val(),module:a("#module_id").val(),session:a("#session_input").val()}),datatype:"json",success:function(b){var c=JSON.parse(b).sessions,d=a("<ul>");if(c.length>0)for(var e=0,f=c.length;e<f;++e){var g=c[e].formateurs+" formateurs / "+c[e].participants+" participants";d.append("<li "+(c[e].linked?"":'data-id="'+c[e].session_id+'" data-name="'+c[e].formation_place+'"')+'><div class="session_logo">'+(c[e].linked?"<a href='"+c[e].linkedurl+"' target='_blank'><i class='fas fa-link fa-3x'></i></a>":"")+'</div><div class ="session_infos"><div class ="session_date">du '+c[e].startdate+" au "+c[e].enddate+' </div><div class ="session_attendance">'+g+'</div><div style="clear: both;"></div><div class="session_title">'+c[e].formation_place_high+"</div></div></li>")}else d.append("<li>Aucun résultat</li>");a("#session_res").html(d),x()},error:function(a){console.log(a)}})}function s(){a.ajax({type:"POST",url:b,data:JSON.stringify({type:"session",courseid:a("#course_id").val(),dispositif:a("#dispositif_id").val(),module:a("#module_id").val(),session:a("#session_id").val()}),datatype:"json",success:function(a){var b=JSON.parse(a).session;t(b.participants),u(b.formateurs),v(b.groups),y()},error:function(a){console.log(a)}})}function t(b){a("#participants ul").html(""),a("#participants span").html("PARTICIPANTS ("+b.length+")");for(var c=0,d=b.length;c<d;++c)a("#participants ul").append("<li"+(c>2?" style='display:none'":"")+">"+b[c].firstname+" "+b[c].lastname+"</li>");b.length>3&&a("#show_participants").show()}function u(b){a("#formateurs select").find("option").remove(),a("#formateurs select").find("optgroup").remove(),a("#formateurs select").append("<optgroup label='FORMATEURS ("+b.length+")'>");for(var c=0,d=b.length;c<d;++c)a("#formateurs select optgroup").append("<option value='"+b[c].id+"'>"+b[c].firstname+" "+b[c].lastname+"</options>")}function v(b){a("#groups select").find("option").remove(),a("#groups select").append("<option value='nogroup' style='font-weight:bold'><b>Aucun groupe</b></options>");for(var c=0,d=b.length;c<d;++c)a("#groups select").append("<option value='"+b[c].id+"'>"+b[c].name+"</options>");a("#groups select").append("<option value='newgroup' style='font-weight:bold'>+ Créer un nouveau groupe</options>"),a("#groups select").change()}function w(b){void 0==b&&(b=!0),a("#module").toggle(b),a("#module_label").toggle(b),0==b&&x(!1)}function x(b){void 0==b&&(b=!0),a("#session").toggle(b),a("#session_label").toggle(b),0==b&&y(!1)}function y(b){void 0==b&&(b=!0),a("#session_data").toggle(b)}function z(){var b=a("#dispositif_id").val(),g=a("#module_id").val(),h=a("#session_id").val();10==b.length&&g>0&&h>0&&(a("#dispositif_input").val(b),f(b,c),a("#module_input").val(g),i(g,d),a("#session_input").val(h),n(h,e))}function A(a){return $dates=a.split("/"),console.log($dates),new Date($dates[2],$dates[1]-1,$dates[0]).getTime()/1e3}function B(){z()}var C={monthNames:["janvier","f&eacute;vrier","mars","avril","mai","juin","juillet","ao&ucirc;t","septembre","octobre","novembre","d&eacute;cembre"],monthNamesShort:["janv.","f&eacute;vr.","mars","avril","mai","juin","juil.","ao&ucirc;t","sept.","oct.","nov.","d&eacute;c."],dayNames:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dayNamesShort:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],dayNamesMin:["D","L","M","M","J","V","S"],dateFormat:"dd/mm/yy",weekHeader:"Sem.",firstDay:1,currentText:"Aujourd'hui",closeText:"Fermer",prevText:"Pr&eacute;c&eacute;dent",nextText:"Suivant",isRTL:!1,showMonthAfterYear:!1};a("#startdate").datepicker(C),a("#enddate").datepicker(C),a("#show_participants").on("click",function(){a(this).hasClass("show")?(a("#participants li").show(),a("#show_participants").html("<i class='fas fa-chevron-up'></i> Voir moins"),a(this).removeClass("show")):(a("#participants li:gt(2)").hide(),a("#show_participants").html("<i class='fas fa-chevron-down'></i> Voir tous"),a(this).addClass("show"))}),a("#formateurs").on("mousedown","option",function(b){return b.preventDefault(),a(this).prop("selected",!a(this).prop("selected")),!1}),a("#add_all_formateurs").change(function(){a("#add_all_formateurs").prop("checked")?(a("#formateurs option").prop("selected",!0),a("#formateurs select").prop("disabled",!0)):(a("#formateurs option").prop("selected",!1),a("#formateurs select").prop("disabled",!1))}),a("#group_select").change(function(){"newgroup"==a(this).children("option:selected").val()?a("#new_group").show():a("#new_group").hide()}),a("#selnone").click(function(b){b.preventDefault(),a("#databases option").prop("selected",!1)}),a("#dispositif_search_btn").on("click",function(){h()}),a("#dispositif_reset_btn").on("click",function(){g(),k(),p()}),a("#dispositif_res").on("click","li",function(){a(this)[0].hasAttribute("data-id")&&f(a(this).attr("data-id"),a(this).attr("data-name"))}),a("#dispositif_input").keypress(function(a){var b=a.keyCode?a.keyCode:a.which;"13"==b&&h()});var D=null;a("#dispositif_input").on("keyup",function(){clearTimeout(D),D=setTimeout(function(){h()},500)}),a("#module_search_btn").on("click",function(){m()}),a("#module_reset_btn").on("click",function(){j(),p()}),a("#module_res").on("click","li",function(){a(this)[0].hasAttribute("data-id")&&i(a(this).attr("data-id"),a(this).attr("data-name"))}),a("#module_input").keypress(function(a){var b=a.keyCode?a.keyCode:a.which;"13"==b&&m()});var E=null;a("#module_input").on("keyup",function(){clearTimeout(E),E=setTimeout(function(){m()},500)}),a("#session_search_btn").on("click",function(){r()}),a("#session_reset_btn").on("click",function(){o()}),a("#session_res").on("click","li",function(){a(this)[0].hasAttribute("data-id")&&n(a(this).attr("data-id"),a(this).attr("data-name"))}),a("#session_input").keypress(function(a){var b=a.keyCode?a.keyCode:a.which;"13"==b&&r()});var F=null;a("#session_input").on("keyup",function(){clearTimeout(F),F=setTimeout(function(){r()},500)}),a(document).ready(function(){B()})}}});